================================================================================
                    PORKCHOP MOOD EXPRESSION SYSTEM ENHANCEMENT PLAN
                              Created: December 11, 2025
================================================================================

--[ 1 - CURRENT STATE ANALYSIS ]------------------------------------------------

Feature                        Status        Notes
------------------------------ ------------- -----------------------------------
Happiness calculation          Partial       Exists but only affects avatar 
                                             state + top bar label
No-repeat phrase selection     Implemented   pickPhraseIdx() with lastPhraseIdx[]
Context phrases with templates Implemented   %s/%d substitution for AP names, etc
Avatar state sync              Partial       updateAvatarState() sets avatar from
                                             happiness, but limited states
Happiness decay                Partial       -1 every phraseInterval (5s) - too
                                             slow and linear
Mood momentum                  NOT IMPL      No boost/decay system with timestamps
Personality traits             NOT IMPL      PersonalityConfig has curiosity/
                                             aggression/patience but UNUSED
Phrase chaining/combos         NOT IMPL      Single phrase per event
Rare/special phrases           NOT IMPL      Equal probability for all phrases
Dynamic data insertion         Partial       Templates exist but limited

--[ 2 - IMPLEMENTATION PHASES ]-------------------------------------------------

----[ 2.1 - Phase 1: Mood Momentum System (Foundation) ]------------------------

Goal: Make happiness feel dynamic - boosts decay over time rather than instant.

Changes:
  1. Add lastHappinessBoost timestamp and happinessBoostAmount
  2. Implement exponential decay: boosts fade over 30-60 seconds
  3. Add getMoodMomentum() to calculate current effective happiness
  4. Update selectPhrase() to use momentum-weighted happiness

Files: mood.h, mood.cpp
Effort: Low (~50 lines)

----[ 2.2 - Phase 2: Mood-Influenced Phrase Selection ]-------------------------

Goal: High happiness should influence phrase selection even in "idle" states.

Changes:
  1. Add weighted phrase pool selection based on happiness level
  2. When happiness > 60, mix in 30% excited phrases even during hunting/idle
  3. When happiness < -30, mix in sad phrases even during active states
  4. Add selectWeightedPhrase() helper function

Files: mood.cpp
Effort: Low (~40 lines)

----[ 2.3 - Phase 3: Rare/Special Phrases ]-------------------------------------

Goal: Add low-probability special phrases for variety and surprise.

Changes:
  1. Add PHRASES_RARE[] array with 10-15 special phrases
  2. 5% chance to override normal phrase with rare one
  3. Track "seen rare phrases" for collection aspect (optional)

Files: mood.cpp
Effort: Low (~30 lines)

----[ 2.4 - Phase 4: Dynamic Data Insertion Templates ]-------------------------

Goal: Phrases reference actual live data for personalization.

Changes:
  1. Create formatDynamicPhrase() function with $VAR token replacement
  2. Support tokens: $NET, $HS, $DEAUTH, $LVL, $KM
  3. Add 10-15 new template phrases like "$NET truffles and counting"
  4. Mix dynamic phrases into existing categories

Files: mood.cpp
Effort: Medium (~80 lines)

----[ 2.5 - Phase 5: Phrase History & Cooldown ]--------------------------------

Goal: Better variety by tracking last N phrases, not just last 1.

Changes:
  1. Replace lastPhraseIdx[category] with circular buffer of last 3 IDs
  2. pickPhraseIdx() checks against all 3 recent phrases
  3. Fallback to random if all non-recent options exhausted

Files: mood.cpp
Effort: Low (~25 lines)

----[ 2.6 - Phase 6: Phrase Chaining (Combos) ]---------------------------------

Goal: Big events trigger 2-3 phrase sequences instead of single phrase.

Changes:
  1. Add phraseQueue[] (max 3) and queuedPhraseCount
  2. onHandshakeCaptured() queues chain: ["GOTCHA!", "that's X today", "oink++"]
  3. update() pops from queue every 2 seconds until empty
  4. Add combo triggers for: handshake, PMKID, 100+ networks milestone

Files: mood.h, mood.cpp
Effort: Medium (~60 lines)

----[ 2.7 - Phase 7: Personality Trait Integration ]----------------------------

Goal: Use existing PersonalityConfig traits to influence phrase selection.

Changes:
  1. Use aggression (0.0-1.0) to weight toward attack phrases vs passive
  2. Use curiosity to weight toward exploration/hunting phrases
  3. Use patience to affect how quickly pig gets bored
  4. Add personality-specific phrase pools

Files: mood.cpp, possibly config.h
Effort: Medium (~70 lines)

----[ 2.8 - Phase 8: Avatar Expression Sync ]-----------------------------------

Goal: Avatar visual changes based on mood intensity, not just category.

Changes:
  1. Add AVATAR_*_INTENSE[] frames for high-intensity states
  2. Increase blink rate when excited, decrease when sleepy
  3. Add ear position variation based on mood
  4. Optional: snout "steam" animation for angry (ASCII art)

Files: avatar.h, avatar.cpp
Effort: Medium (~100 lines)

----[ 2.9 - Phase 9: Contextual Milestone Phrases ]-----------------------------

Goal: React to achievements and milestones with special phrases.

Changes:
  1. Add milestone detection in update(): 10/50/100 networks, 1km, etc.
  2. Trigger special one-time phrases for milestones
  3. Track shown milestones in session to avoid repeat
  4. Integrate with XP achievement system

Files: mood.cpp
Effort: Low (~40 lines)

----[ 2.10 - Phase 10: Mood Persistence Across Sessions ]-----------------------

Goal: Pig remembers if it was happy/sad when you last used it.

Changes:
  1. Save happiness to NVS on mode exit
  2. Load happiness on init (with decay based on time since last use)
  3. Add "missed me?" phrases if happiness was high and time gap is long

Files: mood.cpp, uses existing NVS patterns from xp.cpp
Effort: Low (~35 lines)

--[ 3 - IMPLEMENTATION SUMMARY ]------------------------------------------------

Phase  Feature                    Effort   Dependencies   Impact
------ -------------------------- -------- -------------- --------
1      Mood Momentum              Low      None           High
2      Mood-Influenced Selection  Low      Phase 1        High
3      Rare Phrases               Low      None           Medium
4      Dynamic Templates          Medium   None           High
5      Phrase History Buffer      Low      None           Medium
6      Phrase Chaining            Medium   Phase 4        High
7      Personality Traits         Medium   None           Medium
8      Avatar Expression Sync     Medium   Phase 1        High
9      Milestone Phrases          Low      None           Medium
10     Mood Persistence           Low      Phase 1        Low

--[ 4 - RECOMMENDED ORDER ]-----------------------------------------------------

Quick wins first:     Phases 1, 2, 3, 5 (all Low effort, high/medium impact)
High impact medium:   Phases 4, 6, 8
Polish:               Phases 7, 9, 10

==[EOF]==========================================================================
